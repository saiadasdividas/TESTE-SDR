// Abrir módulo
function openModule(moduleNum) {
    if (!currentSDR) {
        alert('Faça login primeiro!');
        return;
    }
    
    currentModule = moduleNum;
    const module = moduleData[moduleNum];
    
    document.getElementById('modalTitle').textContent = module.title;
    
    const modalBody = document.getElementById('modalBody');
    modalBody.innerHTML = '';
    
    // Adicionar descrição do módulo
    const descriptionDiv = document.createElement('div');
    descriptionDiv.innerHTML = `
        <div style="background: #f0f9ff; padding: 20px; border-radius: 10px; margin-bottom: 25px; border-left: 4px solid #3b82f6;">
            <h4 style="color: #1e40af; margin-bottom: 10px; font-size: 1.1rem;">📚 Sobre este módulo:</h4>
            <p style="color: #1e3a8a; line-height: 1.6; margin: 0;">${module.description}</p>
        </div>
    `;
    modalBody.appendChild(descriptionDiv);
    
    module.questions.forEach((question, index) => {
        const questionDiv = document.createElement('div');
        questionDiv.className = 'practice-area';
        questionDiv.innerHTML = `
            <label style="font-size: 1.1rem; color: #1a365d; margin-bottom: 15px; display: block; font-weight: bold;">
                ${question.label}
            </label>
            
            <div style="background: #fef7e0; padding: 15px; border-radius: 8px; margin-bottom: 15px; border-left: 4px solid #f59e0b;">
                <h5 style="color: #92400e; margin-bottom: 8px; font-size: 0.95rem;">💡 Como desenvolver uma boa resposta:</h5>
                <p style="color: #78350f; line-height: 1.5; margin: 0; font-size: 0.9rem;">${question.explanation}</p>
            </div>
            
            ${question.tips ? `
                <div style="background: #ecfdf5; padding: 12px; border-radius: 8px; margin-bottom: 15px; border-left: 4px solid #10b981;">
                    <p style="color: #047857; line-height: 1.4; margin: 0; font-size: 0.85rem; font-weight: 500;">${question.tips}</p>
                </div>
            ` : ''}
            
            <textarea 
                id="question_${moduleNum}_${index}" 
                placeholder="${question.placeholder}"
                data-module="${moduleNum}"
                data-question="${index}"
                style="min-height: 180px; font-size: 14px; line-height: 1.5;">
            </textarea>
            
            <div style="margin-top: 8px; font-size: 0.8rem; color: #718096;">
                <span id="charCount_${moduleNum}_${index}">0</span> caracteres • Mínimo recomendado: 200 caracteres
            </div>
        `;
        modalBody.appendChild(questionDiv);
    });
    
    // Atualizar status de completude
    updateCompletionStatus(moduleNum);
    
    // Adicionar listeners
    addTextareaListeners(moduleNum<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Treinamento SDR - Embalagens Conceito</title>
<!-- Firebase SDK -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.23.0/firebase-app-compat.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.23.0/firebase-firestore-compat.min.js"></script>
<style>
* {
margin: 0;
padding: 0;
box-sizing: border-box;
}

body {
font-family: 'Arial', sans-serif;
background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
min-height: 100vh;
color: #333;
}

.container {
max-width: 1200px;
margin: 0 auto;
padding: 20px;
}

.header {
text-align: center;
margin-bottom: 40px;
background: white;
padding: 30px;
border-radius: 20px;
box-shadow: 0 15px 35px rgba(0,0,0,0.1);
}

.header h1 {
color: #4a5568;
font-size: 2.5rem;
margin-bottom: 10px;
font-weight: bold;
}

.header p {
color: #718096;
font-size: 1.2rem;
}

/* Login Section */
.login-section {
margin-top: 20px;
padding: 20px;
background: #f8fafc;
border-radius: 15px;
border: 2px solid #e2e8f0;
}

.login-form {
display: flex;
gap: 15px;
justify-content: center;
align-items: center;
flex-wrap: wrap;
margin-bottom: 15px;
}

.login-form input {
padding: 12px 15px;
border-radius: 10px;
border: 2px solid #e2e8f0;
font-size: 16px;
min-width: 200px;
}

.login-form input:focus {
outline: none;
border-color: #667eea;
}

.sdr-info {
display: none;
text-align: center;
padding: 15px;
background: #e6fffa;
border-radius: 10px;
border: 2px solid #38b2ac;
}

.cards-grid {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
gap: 20px;
margin-bottom: 40px;
}

.card {
background: white;
border-radius: 20px;
padding: 0;
box-shadow: 0 10px 25px rgba(0,0,0,0.1);
transition: all 0.3s ease;
overflow: hidden;
cursor: pointer;
min-height: 200px;
display: flex;
flex-direction: column;
}

.card:hover {
transform: translateY(-5px);
box-shadow: 0 20px 40px rgba(0,0,0,0.15);
}

.card.completed {
border: 3px solid #38a169;
}

.card.completed .card-header {
background: linear-gradient(135deg, #38a169 0%, #2f855a 100%);
}

.card-header {
background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
color: white;
padding: 25px;
text-align: center;
}

.card-header h3 {
font-size: 1.3rem;
font-weight: bold;
margin-bottom: 8px;
}

.card-description {
font-size: 0.9rem;
opacity: 0.95;
}

.card-content {
padding: 25px;
flex: 1;
display: flex;
flex-direction: column;
justify-content: center;
text-align: center;
}

.card-status {
font-size: 1.1rem;
color: #718096;
margin-bottom: 15px;
}

.card.completed .card-status {
color: #38a169;
font-weight: bold;
}

.card-disabled {
opacity: 0.6;
cursor: not-allowed;
}

.card-disabled:hover {
transform: none;
box-shadow: 0 10px 25px rgba(0,0,0,0.1);
}

.progress-section {
background: white;
border-radius: 20px;
padding: 30px;
box-shadow: 0 15px 35px rgba(0,0,0,0.1);
margin-bottom: 30px;
}

.progress-section h2 {
color: #4a5568;
margin-bottom: 20px;
text-align: center;
}

.progress-bar {
width: 100%;
height: 20px;
background: #e2e8f0;
border-radius: 10px;
overflow: hidden;
margin-bottom: 15px;
}

.progress-fill {
height: 100%;
background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
width: 0%;
transition: width 0.5s ease;
border-radius: 10px;
}

.progress-text {
text-align: center;
color: #718096;
font-weight: bold;
font-size: 1.1rem;
}

/* Modal Styles */
.modal {
display: none;
position: fixed;
z-index: 1000;
left: 0;
top: 0;
width: 100%;
height: 100%;
background-color: rgba(0,0,0,0.8);
animation: fadeIn 0.3s ease;
}

.modal-content {
background-color: white;
margin: 5% auto;
padding: 0;
border-radius: 20px;
width: 90%;
max-width: 800px;
max-height: 85vh;
overflow-y: auto;
animation: slideIn 0.3s ease;
}

.modal-header {
background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
color: white;
padding: 25px;
border-radius: 20px 20px 0 0;
display: flex;
justify-content: space-between;
align-items: center;
}

.modal-header h2 {
margin: 0;
font-size: 1.5rem;
}

.close {
color: white;
font-size: 28px;
font-weight: bold;
cursor: pointer;
}

.close:hover {
opacity: 0.8;
}

.modal-body {
padding: 30px;
}

.practice-area {
margin-bottom: 25px;
}

.practice-area label {
display: block;
margin-bottom: 10px;
font-weight: bold;
color: #2d3748;
font-size: 1.1rem;
}

.practice-area textarea {
width: 100%;
min-height: 120px;
padding: 15px;
border: 2px solid #e2e8f0;
border-radius: 10px;
font-family: inherit;
font-size: 14px;
transition: border-color 0.3s ease;
resize: vertical;
}

.practice-area textarea:focus {
outline: none;
border-color: #667eea;
box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

.modal-footer {
padding: 20px 30px;
border-top: 1px solid #e2e8f0;
display: flex;
justify-content: space-between;
align-items: center;
}

.btn {
background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
color: white;
border: none;
padding: 12px 25px;
border-radius: 10px;
font-size: 16px;
font-weight: bold;
cursor: pointer;
transition: transform 0.2s ease;
}

.btn:hover {
transform: translateY(-2px);
}

.btn-secondary {
background: #718096;
}

.btn:disabled {
background: #a0aec0;
cursor: not-allowed;
transform: none;
}

.completion-status {
font-size: 0.9rem;
color: #718096;
}

@keyframes fadeIn {
from { opacity: 0; }
to { opacity: 1; }
}

@keyframes slideIn {
from { transform: translateY(-50px); opacity: 0; }
to { transform: translateY(0); opacity: 1; }
}

@media (max-width: 768px) {
.container {
padding: 15px;
}

.header h1 {
font-size: 2rem;
}

.cards-grid {
grid-template-columns: 1fr;
gap: 15px;
}

.login-form {
flex-direction: column;
align-items: stretch;
}

.login-form input {
min-width: auto;
}

.modal-content {
width: 95%;
margin: 10% auto;
}
}
</style>
</head>
<body>
<div class="container">
<div class="header">
<h1>🎯 Treinamento SDR</h1>
<p>Embalagens Conceito - Dominando a Arte da Prospecção B2B</p>

<div class="login-section">
<div id="loginForm" class="login-form">
<input type="text" id="sdrName" placeholder="Seu nome completo">
<input type="email" id="sdrEmail" placeholder="Seu e-mail">
<button class="btn" onclick="initializeSDR()">Iniciar Treinamento</button>
</div>
<div id="sdrInfo" class="sdr-info">
<p><strong>SDR:</strong> <span id="currentSDRName"></span> | <strong>Iniciado em:</strong> <span id="startTime"></span></p>
<button class="btn btn-secondary" onclick="logoutSDR()">Finalizar Sessão</button>
</div>
</div>
</div>

<div class="progress-section">
<h2>📈 Seu Progresso no Treinamento</h2>
<div class="progress-bar">
<div class="progress-fill" id="progressFill"></div>
</div>
<div class="progress-text" id="progressText">Faça login para começar</div>
</div>

<div class="cards-grid" id="cardsGrid">
<div class="card card-disabled" data-module="1">
<div class="card-header">
<h3>🏪 Identificação de Oportunidades</h3>
<div class="card-description">Reconheça sinais de que lojistas precisam de fornecedores</div>
</div>
<div class="card-content">
<div class="card-status">Clique para iniciar</div>
<p>Aprenda a identificar oportunidades de negócio com lojistas e distribuidores.</p>
</div>
</div>

<div class="card card-disabled" data-module="2">
<div class="card-header">
<h3>🎯 Perfil do Cliente Ideal</h3>
<div class="card-description">Defina seu público-alvo perfeito</div>
</div>
<div class="card-content">
<div class="card-status">Clique para iniciar</div>
<p>Construa o perfil detalhado dos lojistas ideais para seu produto.</p>
</div>
</div>

<div class="card card-disabled" data-module="3">
<div class="card-header">
<h3>📞 Técnicas de Qualificação</h3>
<div class="card-description">Domine a metodologia BANT</div>
</div>
<div class="card-content">
<div class="card-status">Clique para iniciar</div>
<p>Aprenda a qualificar prospects usando Budget, Authority, Need e Timeline.</p>
</div>
</div>

<div class="card card-disabled" data-module="4">
<div class="card-header">
<h3>📧 Scripts de E-mail</h3>
<div class="card-description">Crie e-mails que convertem</div>
</div>
<div class="card-content">
<div class="card-status">Clique para iniciar</div>
<p>Desenvolva templates eficazes para diferentes momentos da prospecção.</p>
</div>
</div>

<div class="card card-disabled" data-module="5">
<div class="card-header">
<h3>☎️ Scripts de Cold Call</h3>
<div class="card-description">Domine as ligações de prospecção</div>
</div>
<div class="card-content">
<div class="card-status">Clique para iniciar</div>
<p>Crie abordagens eficazes e trate objeções com confiança.</p>
</div>
</div>

<div class="card card-disabled" data-module="6">
<div class="card-header">
<h3>🔍 Pesquisa e Prospecting</h3>
<div class="card-description">Encontre prospects qualificados</div>
</div>
<div class="card-content">
<div class="card-status">Clique para iniciar</div>
<p>Domine técnicas de pesquisa para encontrar lojistas ideais.</p>
</div>
</div>

<div class="card card-disabled" data-module="7">
<div class="card-header">
<h3>🛡️ Tratamento de Objeções</h3>
<div class="card-description">Transforme "não" em oportunidade</div>
</div>
<div class="card-content">
<div class="card-status">Clique para iniciar</div>
<p>Aprenda a lidar com as objeções mais comuns dos lojistas.</p>
</div>
</div>

<div class="card card-disabled" data-module="8">
<div class="card-header">
<h3>🔄 Follow-up Estratégico</h3>
<div class="card-description">Converta prospects ao longo do tempo</div>
</div>
<div class="card-content">
<div class="card-status">Clique para iniciar</div>
<p>Desenvolva uma estratégia sistemática de acompanhamento.</p>
</div>
</div>
</div>
</div>

<!-- Modal -->
<div id="trainingModal" class="modal">
<div class="modal-content">
<div class="modal-header">
<h2 id="modalTitle">Módulo de Treinamento</h2>
<span class="close" onclick="closeModal()">&times;</span>
</div>
<div class="modal-body" id="modalBody">
<!-- Conteúdo será inserido dinamicamente -->
</div>
<div class="modal-footer">
<div class="completion-status" id="completionStatus">
<span id="answeredCount">0</span> de <span id="totalQuestions">0</span> perguntas respondidas
</div>
<button class="btn" id="completeBtn" onclick="completeModule()" disabled>Concluir Módulo</button>
</div>
</div>
</div>

<script>
// Configuração do Firebase
const firebaseConfig = {
    apiKey: "AIzaSyAxkOOHB1m2vhleekARWnXyhnTjCt251LQ",
    authDomain: "plataforma-de-treinament-9a00b.firebaseapp.com",
    projectId: "plataforma-de-treinament-9a00b",
    storageBucket: "plataforma-de-treinament-9a00b.firebasestorage.app",
    messagingSenderId: "192125351398",
    appId: "1:192125351398:web:c16cc461c4c853132a1227"
};

// Inicializar Firebase
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// Variáveis globais
let currentSDR = null;
let sessionId = null;
let trainingStartTime = null;
let currentModule = null;
let completedModules = [];

// Dados dos módulos
const moduleData = {
    1: {
        title: "🏪 Identificação de Oportunidades",
        description: "Aprenda a reconhecer sinais claros de que uma loja ou distribuidor está precisando de novos fornecedores de embalagens. Esta habilidade é fundamental para um SDR eficaz.",
        questions: [
            {
                label: "Liste 3 indicadores visuais ou comportamentais de que um lojista pode precisar de embalagens:",
                explanation: "Pense em sinais que você pode observar visitando a loja fisicamente ou através das redes sociais. Considere aspectos como estoque, qualidade das embalagens atuais, expansão do negócio, reclamações de clientes, etc.",
                placeholder: "Exemplo de resposta:\n\n1. ESTOQUE BAIXO VISÍVEL: Prateleiras com poucas embalagens ou espaços vazios onde normalmente ficam produtos de embalagem.\n\n2. EMBALAGENS ANTIGAS/DANIFICADAS: Produtos em embalagens amareladas, amassadas ou com design desatualizado em liquidação.\n\n3. EXPANSÃO DO NEGÓCIO: Loja em reforma, novos pontos de venda sendo abertos, ou posts nas redes sociais sobre crescimento.",
                tips: "💡 DICA: Visite lojas concorrentes, siga nas redes sociais, observe promoções de liquidação, converse com vendedores, monitore expansões e reformas na região."
            }
        ]
    },
    2: {
        title: "🎯 Perfil do Cliente Ideal",
        description: "Defina com precisão o perfil dos lojistas, distribuidores e lojas de doces que são ideais para seu produto. Um ICP (Ideal Customer Profile) bem definido aumenta drasticamente sua taxa de conversão.",
        questions: [
            {
                label: "Descreva o perfil completo do lojista ideal para seu produto:",
                explanation: "Considere aspectos como: tempo de mercado, localização, volume de vendas, se já revende embalagens, tamanho da equipe, tipo de clientela, faturamento estimado, etc. Seja específico!",
                placeholder: "Exemplo de resposta:\n\n• PERFIL: Loja de doces estabelecida há 2-5 anos\n• LOCALIZAÇÃO: Shopping centers ou centros comerciais movimentados\n• VOLUME: Vende 1000-3000 unidades de doces/mês\n• FUNCIONÁRIOS: 3-8 pessoas na equipe\n• PÚBLICO: Classes B e C, foco em presentes e eventos\n• CARACTERÍSTICA: Já revende embalagens como produto complementar\n• FATURAMENTO: Entre R$ 15.000 - R$ 50.000/mês",
                tips: "💡 DICA: Analise seus melhores clientes atuais. Que características eles têm em comum? Use essas informações para criar o perfil ideal."
            },
            {
                label: "Quais são as 5 principais dores/problemas que esse lojista enfrenta?",
                explanation: "Pense nos desafios reais que impedem o crescimento do negócio. Dores relacionadas a fornecedores, custos, qualidade, prazos, variedade, atendimento, etc. Suas soluções devem resolver essas dores.",
                placeholder: "Exemplo de resposta:\n\n1. FORNECEDORES INSTÁVEIS: Dificuldade para encontrar fornecedores confiáveis que entreguem no prazo\n\n2. PREÇOS NÃO COMPETITIVOS: Margens baixas devido a preços altos dos fornecedores atuais\n\n3. VARIEDADE LIMITADA: Poucos modelos/tamanhos disponíveis para atender diferentes tipos de doces\n\n4. QUALIDADE INCONSISTENTE: Embalagens que chegam danificadas ou com defeitos\n\n5. ATENDIMENTO DEFICIENTE: Dificuldade de contato, demora nas respostas, falta de suporte pós-venda",
                tips: "💡 DICA: Faça pesquisas diretas, leia avaliações no Google, monitore grupos de Facebook de lojistas, converse com clientes atuais sobre suas dificuldades."
            }
        ]
    },
    3: {
        title: "📞 Técnicas de Qualificação",
        description: "Domine a metodologia BANT (Budget, Authority, Need, Timeline) para qualificar prospects de forma eficiente. Isso evita perda de tempo com clientes que não têm potencial real de compra.",
        questions: [
            {
                label: "Crie 3 perguntas estratégicas para qualificar o ORÇAMENTO do prospect:",
                explanation: "O objetivo é descobrir se eles têm capacidade financeira para comprar, qual o volume de compras mensais, e se existe orçamento aprovado. Seja sutil, não pergunte diretamente 'quanto vocês ganham'.",
                placeholder: "Exemplo de resposta:\n\n1. 'Qual o volume aproximado de embalagens que vocês trabalham por mês?' (descobre escala de compra)\n\n2. 'Vocês já têm um orçamento definido mensalmente para fornecedores de embalagens?' (verifica se há budget separado)\n\n3. 'Como vocês avaliam atualmente o investimento em embalagens - consideram um custo ou um investimento no negócio?' (entende mentalidade financeira)",
                tips: "💡 DICA: Pergunte sobre volume, não sobre dinheiro. Pergunte sobre processos, não sobre valores específicos. Use perguntas consultivas."
            },
            {
                label: "Desenvolva 3 perguntas para identificar quem tem AUTORIDADE na decisão:",
                explanation: "Você precisa falar com quem realmente decide sobre compras. Muitas vezes o vendedor não é o decisor. Descubra a hierarquia de decisão para não perder tempo.",
                placeholder: "Exemplo de resposta:\n\n1. 'Como funciona o processo de decisão para novos fornecedores aqui na loja?' (entende o fluxo)\n\n2. 'Além de você, quem mais participa da escolha dos fornecedores de embalagens?' (identifica outros envolvidos)\n\n3. 'Para aprovarmos uma parceria, você precisa consultar alguém ou a decisão é sua?' (confirma autonomia)",
                tips: "💡 DICA: Seja respeitoso ao perguntar sobre hierarquia. Use termos como 'processo' e 'equipe' ao invés de questionar autoridade diretamente."
            },
            {
                label: "Formule 3 perguntas para identificar a real NECESSIDADE:",
                explanation: "Descubra se eles realmente precisam do que você oferece, quais problemas enfrentam com fornecedores atuais, e o nível de satisfação atual. Sem necessidade real, não há venda.",
                placeholder: "Exemplo de resposta:\n\n1. 'Como vocês escolheram os fornecedores atuais de embalagens? O que mais pesou na decisão?' (entende critérios)\n\n2. 'Se pudessem melhorar uma coisa nos fornecedores atuais, o que seria?' (descobre insatisfações)\n\n3. 'Vocês já tiveram alguma situação onde faltou embalagem ou chegou com defeito? Como resolveram?' (identifica dores reais)",
                tips: "💡 DICA: Foque em problemas, não em produtos. Deixe o cliente falar sobre suas dificuldades. Use perguntas abertas que começam com 'como', 'o que', 'por que'."
            }
        ]
    },
    4: {
        title: "📧 Scripts de E-mail",
        description: "Desenvolva e-mails que realmente chamam atenção e geram respostas. E-mails genéricos são ignorados. Aprenda a personalizar e criar valor desde o primeiro contato.",
        questions: [
            {
                label: "Crie um e-mail de primeiro contato personalizado para uma loja de doces:",
                explanation: "Deve incluir: assunto atrativo, personalização (mencionar algo específico da loja), proposta de valor clara, call-to-action simples, e ser conciso (máximo 100 palavras no corpo).",
                placeholder: "Exemplo de resposta:\n\nAssunto: Aumentar lucro da [Nome da Loja] em 15% - 5 minutos?\n\nOlá [Nome],\n\nVi que a [Nome da Loja] tem ótimas avaliações no Google e imagino que vocês trabalham com um bom volume de embalagens.\n\nAjudamos a Doçura Premium (similar à sua loja) a aumentar a margem de lucro em 15% otimizando fornecedores de embalagens.\n\nTem 5 minutos esta semana para eu mostrar como?\n\nAbraços,\n[Seu nome]\n[Telefone]\nEmbalagens Conceito",
                tips: "💡 DICA: Pesquise a loja no Google, veja fotos, leia avaliações. Mencione algo específico. Use números (15%, 5 minutos). Inclua prova social (cliente similar)."
            },
            {
                label: "Desenvolva um e-mail de follow-up para quando não há resposta:",
                explanation: "Deve ser diferente do primeiro, agregar novo valor, criar urgência suave, oferecer saída fácil, e manter tom amistoso. Muitas vendas acontecem no follow-up.",
                placeholder: "Exemplo de resposta:\n\nAssunto: Re: [Nome da Loja] + última tentativa 😊\n\nOi [Nome],\n\nSei que devem estar com a agenda apertada (loja movimentada é bom sinal!).\n\nPensei em compartilhar rapidamente: a Doce Momento economizou R$ 2.400 no último trimestre mudando apenas 2 fornecedores.\n\nSe não fizer sentido para vocês agora, sem problemas - pode me avisar que paro de incomodar 😊\n\nCaso contrário, que tal 10 minutos no WhatsApp ainda esta semana?\n\nAbraços,\n[Seu nome]",
                tips: "💡 DICA: Seja empático ('sei que estão ocupados'). Agregue novo valor (novo case, economia). Ofereça saída fácil. Use emojis com moderação."
            }
        ]
    },
    5: {
        title: "☎️ Scripts de Cold Call",
        description: "Domine as ligações de prospecção com abordagens que funcionam. Cold calls bem feitos ainda são uma das ferramentas mais eficazes para SDRs, mas precisam ser estratégicos.",
        questions: [
            {
                label: "Desenvolva uma abertura de cold call de 30 segundos para lojistas:",
                explanation: "Deve incluir: apresentação rápida, motivo da ligação, benefício claro, pedido de permissão para continuar. Tempo limitado força você a ir direto ao ponto mais importante.",
                placeholder: "Exemplo de resposta:\n\n'Olá [Nome]! Aqui é [Seu Nome] da Embalagens Conceito. Estou ligando porque vi que vocês têm uma loja de doces muito bem avaliada e imagino que trabalham com um volume interessante de embalagens.\n\nTenho ajudado lojas similares à sua a economizar entre 10-20% nos custos de embalagens mantendo a mesma qualidade.\n\nTenho 2 minutos para explicar como isso funciona ou peguei vocês em um momento ruim?'\n\n[PAUSA PARA RESPOSTA]",
                tips: "💡 DICA: Pratique cronometrando. Fale devagar e clara. Faça uma pergunta no final. Esteja preparado para objeções. Sorria ao falar (muda o tom de voz)."
            },
            {
                label: "Crie uma resposta completa para a objeção 'Já temos fornecedor e estamos satisfeitos':",
                explanation: "Esta é a objeção mais comum. Sua resposta deve: validar a objeção, fazer uma pergunta inteligente, criar curiosidade, e propor próximo passo pequeno. Não tente vender na objeção.",
                placeholder: "Exemplo de resposta:\n\n'Entendo perfeitamente, [Nome]! Na verdade, 90% dos nossos clientes também tinham fornecedores quando nos conheceram.\n\nUma pergunta rápida: vocês estão 100% satisfeitos com prazo de entrega, variedade de produtos e preços? Ou existe sempre algo que poderia melhorar?\n\n[PAUSA PARA RESPOSTA]\n\nÉ que nossa proposta não é substituir o que funciona, mas complementar com itens que talvez vocês não encontrem facilmente, ou backup para quando o fornecedor principal falha.\n\nQue tal eu mostrar em 5 minutos como isso funciona, sem compromisso?'",
                tips: "💡 DICA: Nunca critique o fornecedor atual. Use estatísticas (90% dos clientes). Faça perguntas que criam dúvidas. Ofereça complemento, não substituição."
            }
        ]
    },
    6: {
        title: "🔍 Pesquisa e Prospecting",
        description: "Aprenda a encontrar prospects qualificados de forma sistemática e eficiente. Prospecting bem feito é 50% do sucesso em vendas. Qualidade é mais importante que quantidade.",
        questions: [
            {
                label: "Liste 5 fontes específicas e métodos para encontrar lojistas qualificados:",
                explanation: "Pense em fontes online e offline, ferramentas gratuitas e pagas, métodos diretos e indiretos. Inclua como usar cada fonte e que tipo de informação você pode obter de cada uma.",
                placeholder: "Exemplo de resposta:\n\n1. GOOGLE MAPS: Buscar 'loja de doces + [cidade]' - permite ver localização, fotos, horários, avaliações e contato direto\n\n2. INSTAGRAM/FACEBOOK: Buscar hashtags #doceria #confeitaria [cidade] - mostra engajamento, estilo da loja, eventos, promoções\n\n3. SHOPPINGS CENTERS: Visita presencial aos corredores de alimentação - observação direta do movimento, conversa com lojistas\n\n4. ASSOCIAÇÕES COMERCIAIS: SEBRAE, CDL, sindicatos locais - listas de associados, eventos de networking\n\n5. INDICAÇÕES DE CLIENTES: Perguntar 'conhece outras lojas que poderiam se interessar?' - leads mais qualificados",
                tips: "💡 DICA: Combine métodos online e offline. Foque primeiro em sua região. Use ferramentas gratuitas antes de pagar. Organize tudo em planilha."
            },
            {
                label: "Defina quais informações essenciais coletar ANTES de fazer o primeiro contato:",
                explanation: "Informações que ajudam na personalização, qualificação inicial, e estratégia de abordagem. Pense em dados que você pode descobrir sem falar com eles ainda.",
                placeholder: "Exemplo de resposta:\n\n• NOME DO RESPONSÁVEL: Dono, gerente ou pessoa que decide compras\n• TEMPO DE MERCADO: Há quanto tempo a loja existe (estabilidade)\n• LOCALIZAÇÃO ESTRATÉGICA: Shopping, rua, centro - indica movimento\n• PRESENÇA DIGITAL: Site, redes sociais ativas, engajamento\n• ESTILO/PÚBLICO: Doces finos, populares, infantis, eventos\n• TAMANHO APARENTE: Quantidade de funcionários, tamanho da loja\n• CONCORRENTES PRÓXIMOS: Quantas lojas similares na região\n• AVALIAÇÕES ONLINE: Google, Facebook - satisfação dos clientes\n• PRODUTOS VENDIDOS: Além de doces, vendem embalagens?",
                tips: "💡 DICA: Use Google Street View para 'visitar' a loja. Verifique se têm delivery (indica volume). Veja posts recentes nas redes sociais."
            }
        ]
    },
    7: {
        title: "🛡️ Tratamento de Objeções",
        description: "Transforme objeções em oportunidades de venda. Objeções são naturais e muitas vezes indicam interesse. Aprenda a tratá-las com confiança e técnica, não com pressão.",
        questions: [
            {
                label: "Desenvolva uma resposta completa para: 'Seus preços são muito altos':",
                explanation: "Esta objeção é sobre valor percebido, não sobre preço. Sua resposta deve: reconhecer a preocupação, fazer perguntas investigativas, apresentar valor/ROI, usar prova social, e propor próximo passo.",
                placeholder: "Exemplo de resposta:\n\n'Entendo sua preocupação com investimento, [Nome]. Posso perguntar: vocês estão comparando apenas o preço unitário ou o custo-benefício total?\n\n[PAUSA]\n\nPor exemplo, a Loja Doce Paixão pensava igual. Aí calculamos: economizaram R$ 1.200 em 3 meses porque nossas embalagens têm menos quebra no transporte e melhor aceitação dos clientes.\n\nAlém disso, nossa entrega é em 24h (não 7 dias), então não precisam estocar tanto.\n\nQue tal eu mostrar essa conta completa para sua realidade? Pode ser que o 'investimento maior' na verdade seja uma economia no final das contas.'",
                tips: "💡 DICA: Nunca baixe preço na primeira objeção. Foque em valor total, não preço unitário. Use cases reais. Mostre ROI calculado."
            },
            {
                label: "Crie uma resposta estratégica para: 'Não temos tempo agora, ligam depois':",
                explanation: "Esta é uma objeção de timing, não de interesse. Pode ser real ou desculpa. Sua resposta deve: validar a situação, criar urgência suave, propor alternativa flexível, e garantir follow-up definido.",
                placeholder: "Exemplo de resposta:\n\n'Imagino mesmo, [Nome]! Loja movimentada é sinal de que as coisas vão bem, parabéns!\n\nUma pergunta rápida: essa correria é mais sazonal (época específica) ou vocês estão sempre nesse ritmo?\n\n[ESCUTA A RESPOSTA]\n\nEntendo. Olha, justamente por isso que pode fazer sentido conversarmos. Muitos dos nossos clientes economizam até 3 horas por semana só organizando melhor os fornecedores.\n\nQue tal assim: eu mando um WhatsApp com um case rápido de 2 minutos, aí quando vocês tiverem um tempinho, dão uma olhada? Sem pressão.\n\nQual o melhor número para mandar?'",
                tips: "💡 DICA: Valide a situação real. Conecte sua solução com a falta de tempo deles. Ofereça formato que não demanda tempo imediato."
            }
        ]
    },
    8: {
        title: "🔄 Follow-up Estratégico",
        description: "Desenvolva um sistema de acompanhamento que converte prospects ao longo do tempo. A maioria das vendas B2B acontece entre o 5º e 12º contato. Seja sistemático, não invasivo.",
        questions: [
            {
                label: "Crie um cronograma de follow-up de 30 dias com 6 pontos de contato:",
                explanation: "Inclua: canal de contato (e-mail, ligação, WhatsApp), objetivo de cada contato, tipo de valor agregado, e timing específico. Varie os canais e tipos de abordagem.",
                placeholder: "Exemplo de resposta:\n\nDIA 1: E-mail inicial personalizado (primeiro contato)\nDIA 3: Ligação de follow-up (verificar recebimento do e-mail)\nDIA 7: WhatsApp com case de sucesso relevante\nDIA 14: E-mail com dica valiosa do setor + proposta simples\nDIA 21: Ligação final com oferta específica/urgência\nDIA 30: E-mail de 'última tentativa' com saída educada\n\n* Entre os contatos: monitorar redes sociais, comentar posts, engajar sutilmente\n* Após dia 30: adicionar à lista de nutrição mensal (1 contato por mês)",
                tips: "💡 DICA: Varie sempre o canal. Agregue valor novo a cada contato. Tenha um CRM simples para controlar. Respeite quem pedir para parar."
            },
            {
                label: "Desenvolva 4 tipos diferentes de valor para agregar em cada follow-up:",
                explanation: "Pense em conteúdos úteis que demonstram expertise e ajudam o lojista, mesmo que ele não compre. Valor educativo constrói relacionamento e credibilidade a longo prazo.",
                placeholder: "Exemplo de resposta:\n\n1. CASES DE SUCESSO: 'Como a Loja X aumentou vendas em 25% mudando apenas o tipo de embalagem para presentes'\n\n2. DICAS DE MERCADO: 'Tendência: embalagens sustentáveis aumentaram procura em 40% no último trimestre'\n\n3. FERRAMENTAS ÚTEIS: 'Calculadora gratuita: descubra se suas embalagens estão com preço competitivo'\n\n4. ALERTAS SAZONAIS: 'Faltam 45 dias para Dia das Mães - histórico mostra aumento de 60% na demanda por embalagens de presente'\n\n* Bônus: Convites para eventos, webinars, ou networking do setor",
                tips: "💡 DICA: Crie um banco de conteúdos úteis. Use dados e estatísticas. Conecte sempre com a realidade do lojista. Seja consultivo."
            }
        ]
    }
};

// Inicializar SDR
function initializeSDR() {
    const name = document.getElementById('sdrName').value.trim();
    const email = document.getElementById('sdrEmail').value.trim();
    
    if (!name || !email) {
        alert('Por favor, preencha seu nome e e-mail para continuar.');
        return;
    }
    
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailRegex.test(email)) {
        alert('Por favor, insira um e-mail válido.');
        return;
    }
    
    currentSDR = { name, email };
    sessionId = generateSessionId();
    trainingStartTime = new Date();
    
    // Salvar início da sessão
    saveToFirebase('session_start', {
        sdrName: name,
        sdrEmail: email,
        sessionId: sessionId,
        startTime: trainingStartTime,
        status: 'iniciado'
    });
    
    // Atualizar interface
    document.getElementById('loginForm').style.display = 'none';
    document.getElementById('sdrInfo').style.display = 'block';
    document.getElementById('currentSDRName').textContent = name;
    document.getElementById('startTime').textContent = trainingStartTime.toLocaleString('pt-BR');
    document.getElementById('progressText').textContent = '0% Concluído - Clique em um módulo para começar';
    
    // Habilitar cards
    enableTraining();
}

// Logout do SDR
function logoutSDR() {
    if (confirm('Tem certeza que deseja finalizar a sessão? O progresso será salvo.')) {
        saveToFirebase('session_end', {
            sessionId: sessionId,
            endTime: new Date(),
            status: 'finalizado'
        });
        location.reload();
    }
}

// Gerar ID único da sessão
function generateSessionId() {
    return 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
}

// Habilitar treinamento
function enableTraining() {
    const cards = document.querySelectorAll('.card');
    cards.forEach(card => {
        card.classList.remove('card-disabled');
        card.addEventListener('click', () => {
            const moduleNum = parseInt(card.dataset.module);
            openModule(moduleNum);
        });
    });
}

// Abrir módulo
function openModule(moduleNum) {
    if (!currentSDR) {
        alert('Faça login primeiro!');
        return;
    }
    
    currentModule = moduleNum;
    const module = moduleData[moduleNum];
    
    document.getElementById('modalTitle').textContent = module.title;
    
    const modalBody = document.getElementById('modalBody');
    modalBody.innerHTML = '';
    
    // Adicionar descrição do módulo
    const descriptionDiv = document.createElement('div');
    descriptionDiv.innerHTML = `
        <div style="background: #f0f9ff; padding: 20px; border-radius: 10px; margin-bottom: 25px; border-left: 4px solid #3b82f6;">
            <h4 style="color: #1e40af; margin-bottom: 10px; font-size: 1.1rem;">📚 Sobre este módulo:</h4>
            <p style="color: #1e3a8a; line-height: 1.6; margin: 0;">${module.description}</p>
        </div>
    `;
    modalBody.appendChild(descriptionDiv);
    
    module.questions.forEach((question, index) => {
        const questionDiv = document.createElement('div');
        questionDiv.className = 'practice-area';
        questionDiv.innerHTML = `
            <label style="font-size: 1.1rem; color: #1a365d; margin-bottom: 15px; display: block; font-weight: bold;">
                ${question.label}
            </label>
            
            <div style="background: #fef7e0; padding: 15px; border-radius: 8px; margin-bottom: 15px; border-left: 4px solid #f59e0b;">
                <h5 style="color: #92400e; margin-bottom: 8px; font-size: 0.95rem;">💡 Como desenvolver uma boa resposta:</h5>
                <p style="color: #78350f; line-height: 1.5; margin: 0; font-size: 0.9rem;">${question.explanation}</p>
            </div>
            
            ${question.tips ? `
                <div style="background: #ecfdf5; padding: 12px; border-radius: 8px; margin-bottom: 15px; border-left: 4px solid #10b981;">
                    <p style="color: #047857; line-height: 1.4; margin: 0; font-size: 0.85rem; font-weight: 500;">${question.tips}</p>
                </div>
            ` : ''}
            
            <textarea 
                id="question_${moduleNum}_${index}" 
                placeholder="${question.placeholder}"
                data-module="${moduleNum}"
                data-question="${index}"
                style="min-height: 180px; font-size: 14px; line-height: 1.5;">
            </textarea>
            
            <div style="margin-top: 8px; font-size: 0.8rem; color: #718096;">
                <span id="charCount_${moduleNum}_${index}">0</span> caracteres • Mínimo recomendado: 200 caracteres
            </div>
        `;
        modalBody.appendChild(questionDiv);
    });
    
    // Atualizar status de completude
    updateCompletionStatus(moduleNum);
    
    // Adicionar listeners
    addTextareaListeners(moduleNum);
    
    document.getElementById('trainingModal').style.display = 'block';
}

// Fechar modal
function closeModal() {
    document.getElementById('trainingModal').style.display = 'none';
}

// Adicionar listeners aos textareas
function addTextareaListeners(moduleNum) {
    const textareas = document.querySelectorAll(`textarea[data-module="${moduleNum}"]`);
    textareas.forEach(textarea => {
        // Atualizar contador de caracteres
        function updateCharCount() {
            const charCount = textarea.value.length;
            const countSpan = document.getElementById(`charCount_${moduleNum}_${textarea.dataset.question}`);
            if (countSpan) {
                countSpan.textContent = charCount;
                countSpan.style.color = charCount >= 200 ? '#059669' : '#dc2626';
            }
        }
        
        // Event listeners
        textarea.addEventListener('input', function() {
            const questionIndex = this.dataset.question;
            const module = moduleData[moduleNum];
            
            // Salvar no Firebase
            saveToFirebase('answer', {
                sessionId: sessionId,
                moduleNumber: moduleNum,
                moduleTitle: module.title,
                questionIndex: parseInt(questionIndex),
                question: module.questions[questionIndex].label,
                answer: this.value,
                timestamp: new Date(),
                characterCount: this.value.length
            });
            
            // Atualizar contador
            updateCharCount();
            
            // Atualizar status de completude
            updateCompletionStatus(moduleNum);
        });
        
        // Inicializar contador
        updateCharCount();
    });
}

// Atualizar status de completude do módulo
function updateCompletionStatus(moduleNum) {
    const textareas = document.querySelectorAll(`textarea[data-module="${moduleNum}"]`);
    const totalQuestions = textareas.length;
    let answeredCount = 0;
    
    textareas.forEach(textarea => {
        if (textarea.value.trim().length >= 50) { // Mínimo de 50 caracteres
            answeredCount++;
        }
    });
    
    document.getElementById('answeredCount').textContent = answeredCount;
    document.getElementById('totalQuestions').textContent = totalQuestions;
    
    const completeBtn = document.getElementById('completeBtn');
    if (answeredCount === totalQuestions) {
        completeBtn.disabled = false;
        completeBtn.textContent = 'Concluir Módulo ✓';
        completeBtn.style.background = 'linear-gradient(135deg, #059669 0%, #047857 100%)';
    } else {
        completeBtn.disabled = true;
        completeBtn.textContent = `Concluir Módulo (${answeredCount}/${totalQuestions})`;
        completeBtn.style.background = '#a0aec0';
    }
}

// Completar módulo
function completeModule() {
    if (!currentModule) return;
    
    const textareas = document.querySelectorAll(`textarea[data-module="${currentModule}"]`);
    let allAnswered = true;
    let incompleteQuestions = [];
    
    textareas.forEach((textarea, index) => {
        if (textarea.value.trim().length < 50) {
            allAnswered = false;
            incompleteQuestions.push(index + 1);
        }
    });
    
    if (!allAnswered) {
        alert(`Por favor, complete as perguntas: ${incompleteQuestions.join(', ')}.\nCada resposta deve ter pelo menos 50 caracteres para ser considerada completa.`);
        return;
    }
    
    // Verificar qualidade mínima das respostas
    let shortAnswers = [];
    textareas.forEach((textarea, index) => {
        if (textarea.value.trim().length < 200) {
            shortAnswers.push(index + 1);
        }
    });
    
    if (shortAnswers.length > 0) {
        const proceed = confirm(`As perguntas ${shortAnswers.join(', ')} têm menos de 200 caracteres.\n\nRecomendamos respostas mais detalhadas para melhor aproveitamento do treinamento.\n\nDeseja continuar mesmo assim?`);
        if (!proceed) return;
    }
    
    // Marcar módulo como concluído
    if (!completedModules.includes(currentModule)) {
        completedModules.push(currentModule);
        
        // Salvar conclusão do módulo
        saveToFirebase('module_completed', {
            sessionId: sessionId,
            moduleNumber: currentModule,
            moduleTitle: moduleData[currentModule].title,
            completionTime: new Date(),
            answersQuality: textareas.length > 0 ? 
                Array.from(textareas).map(t => ({
                    length: t.value.length,
                    quality: t.value.length >= 200 ? 'good' : t.value.length >= 100 ? 'fair' : 'poor'
                })) : []
        });
        
        // Atualizar visual do card
        const card = document.querySelector(`[data-module="${currentModule}"]`);
        card.classList.add('completed');
        const statusElement = card.querySelector('.card-status');
        statusElement.textContent = 'Concluído ✓';
        statusElement.style.color = '#38a169';
        statusElement.style.fontWeight = 'bold';
        
        updateProgress();
        
        // Feedback positivo
        setTimeout(() => {
            alert(`🎉 Parabéns! Módulo "${moduleData[currentModule].title}" concluído com sucesso!\n\nSuas respostas foram salvas e enviadas para avaliação.`);
        }, 500);
    }
    
    closeModal();
}

// Atualizar progresso geral
function updateProgress() {
    const totalModules = Object.keys(moduleData).length;
    const progress = Math.round((completedModules.length / totalModules) * 100);
    
    document.getElementById('progressFill').style.width = progress + '%';
    document.getElementById('progressText').textContent = `${progress}% Concluído (${completedModules.length}/${totalModules} módulos)`;
    
    // Salvar progresso
    saveToFirebase('progress', {
        sessionId: sessionId,
        progress: progress,
        completedModules: completedModules.length,
        totalModules: totalModules,
        timestamp: new Date()
    });
    
    // Verificar se terminou
    if (progress === 100) {
        setTimeout(() => {
            saveToFirebase('training_completed', {
                sessionId: sessionId,
                completionTime: new Date(),
                totalDuration: new Date() - trainingStartTime
            });
            
            alert('🎉 Parabéns! Você concluiu o treinamento SDR! Suas respostas foram enviadas para avaliação.');
        }, 500);
    }
}

// Salvar dados no Firebase
async function saveToFirebase(type, data) {
    try {
        await db.collection('sdr_training').add({
            type: type,
            data: data,
            timestamp: firebase.firestore.FieldValue.serverTimestamp()
        });
        console.log('Dados salvos:', type);
    } catch (error) {
        console.error('Erro ao salvar:', error);
    }
}

// Fechar modal clicando fora
window.onclick = function(event) {
    const modal = document.getElementById('trainingModal');
    if (event.target === modal) {
        closeModal();
    }
}

// Salvar estado ao sair
window.addEventListener('beforeunload', function() {
    if (currentSDR) {
        saveToFirebase('session_pause', {
            sessionId: sessionId,
            pauseTime: new Date(),
            status: 'pausado'
        });
    }
});
</script>
</body>
</html>
